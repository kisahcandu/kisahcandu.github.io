name: Generate Sitemap and Robots.txt # Nama workflow ini

on:
  push:
    branches:
      - main # Trigger workflow ini ketika ada push ke branch 'main'
    paths:
      - '_posts/**' # Hanya jalankan jika ada perubahan di dalam folder '_posts'
  schedule:
    - cron: '0 0 * * *' # Jalankan workflow ini setiap hari pada tengah malam UTC
  workflow_dispatch: # Trigger manual: memungkinkan kamu menjalankan workflow dari UI GitHub

jobs:
  build:
    runs-on: ubuntu-latest # Jalankan job ini di runner Ubuntu terbaru
    permissions:
      contents: write # Berikan izin tulis ke GITHUB_TOKEN agar bisa push perubahan

    steps:
      - name: Checkout repository # Langkah untuk meng-clone repository kamu
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Ambil semua riwayat untuk mendapatkan waktu modifikasi yang akurat

      - name: Set up Python # Langkah untuk menyiapkan lingkungan Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Gunakan versi Python 3 terbaru

      - name: Install dependencies # Langkah untuk menginstal library Python yang dibutuhkan
        run: |
          pip install requests

      - name: Generate Sitemap and Robots.txt # Langkah untuk menjalankan skrip Python
        run: python generate_sitemap.py

      - name: Commit and Push changes # Langkah untuk melakukan commit dan push file yang dihasilkan
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add sitemap.xml robots.txt
          # Hanya lakukan commit jika ada perubahan pada file yang di-stage
          git diff --cached --exit-code || git commit -m "chore: Auto-generate sitemap and robots.txt"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
